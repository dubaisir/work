sql="
use ${HIVE_DB_DWS};
set hive.exec.dynamic.partition.mode=nonstrict;
set hive.exec.max.dynamic.partitions=100000;
set hive.exec.max.dynamic.partitions.pernode=100000;
set hive.exec.parallel=true;
set hive.exec.parallel.thread.number=16;
set hive.exec.dynamic.partition.mode=nonstrict;
with date as (
select
year
,cast(the_date as string) as the_date
,the_month
,first_day_of_month
,last_day_of_month
from ${HIVE_DB_DIM}.pub_longfor_date
where the_date<'${END_DATEKEY}'
and (( the_date>=date_sub('${START_DATEKEY}',2) and  cast(substr('${END_DATEKEY}',9,2)  as int)<>3) or  ( substr(the_date,1,7)>=substr(add_months('${START_DATEKEY}',-1),1,7) and  cast(substr('${END_DATEKEY}',9,2)  as int)=3)  )
),
tempcotract as
(select
a.year
,a.the_date
,row_number() over(partition by b.project_guid, b.contract_no, a.the_date order by substr(b.createdate,1,10) desc) rn
,b.contract_id as contractid
,b.contract_no as contractno
,b.companyguid
,b.project_guid
,b.parentid
,b.topparent_id
,b.contract_type
,b.rentcal_mode
,b.rental_type
,b.run_time
,b.contracttypedesc
,b.defaultstartdate
,b.defaultexpirydate
,b.quit_date
,b.overlay_date
,b.account_id
,b.account_name
,b.totalarea
,b.branddesc
,b.main_formatid
,b.open_date
,b.close_date
,b.start_date
,b.end_date
,b.createdate
,case
when nvl(zskdata.documentamt
,0) > 0 then
1
else
0
end issk --是否已收款
,case when   substr(b.close_date,1,10)>=a.the_date then '1' else '0' end as is_close_date
,case when  (substr(b.filing_date,1,10)<=a.the_date or nvl(zskdata.documentamt,0) > 0)  and substr(b.close_date,1,10)>=a.the_date then '1' else '0'  end is_bill  --去账单\已出租面积
,case when  (substr(b.defaultstartdate,1,10)<=a.the_date and substr(b.close_date,1,10)>=a.the_date) and  substr(b.filing_date,1,10)<=a.the_date  then '1' else '0' end as is_jp
,case when  (substr(b.open_date,1,10)<=a.the_date and substr(b.close_date,1,10)>=a.the_date) and  substr(b.filing_date,1,10)<=a.the_date then '1' else 0 end as is_open
,case when  (substr(b.filing_date,1,10)<=a.the_date and substr(b.close_date,1,10)>=a.the_date) then '1'  else '0' end as is_filling  --是否已归档
,case when  (substr(b.filing_date,1,10)<=a.the_date and substr(b.close_date,1,10)>=a.the_date  and nvl(zskdata.documentamt,0) > 0 ) then '1'  else '0' end as is_filing_receipt  --归档且已收保证金
,case when  (substr(b.run_time,1,10)<=a.the_date and    substr(b.close_date,1,10)>=a.the_date)  then '1' else '0' end as is_run  --已提网
,b.filing_date filing_date --归档日期
from date a
left join ${HIVE_DB_DIM}.d05_longfor_contract b
on 1=1
--应收暂收款
left join (select
a.the_date
,rc.projectguid
,rc.contractno
,sum(cr.documentamt) documentamt
from date a
left join ${HIVE_DB_DWS}.f05_longfor_receipt cr
on 1 = 1
left join ${HIVE_DB_DWS}.f05_longfor_contract rc
on cr.contractid = rc.contractid
where 1 = 1
and substr(cr.documentdate,1,10) <= a.the_date
and cr.status != 'INACTIVE'
and cr.contractid is not null
and rc.status not in ('INACTIVE'
,'ACTIVE'
,'SUBMITTED')
group by rc.projectguid
,rc.contractno
,a.the_date) zskdata
on zskdata.projectguid = b.project_guid
and zskdata.the_date = a.the_date
and zskdata.contractno = b.contract_no
-- 主力店、次主力店、专卖店、场地
where b.contract_status not in ('INACTIVE'
,'ACTIVE'
,'SUBMITTED') --非 草稿、无效,审批中
--and (b.filing_date<=a.the_date or nvl(zskdata.documentamt,0) > 0)
--   and b.rental_type in ('Main'
--   ,'Exclusive'
--   ,'SubAnchor'
--   ,'Site'
--   ,'SingleCabinet')
and ((b.topparent_id is not null and
substr(b.start_date,1,10) <= a.the_date) or b.topparent_id is null)
),contract_status as (select
h.the_date
,h.contractno
,h.project_guid
,h.issk
,nvl(nvl(b.contractid,a.contractid),h.contractid) as contractid
,case when a.contractno is not null or b.contractno is not null  then '1' else '0' end as  is_yrent
,case when b.contractno is not null then '1' else '0' end as  is_jp
,case when c.contractno is not null then '1' else '0' end as  is_open
, case when d.contractno is not null then '1' else '0' end as is_filling
, case when e.contractno is not null then '1' else '0' end as is_filing_receipt
,case when f.contractno is not null then  '1' else  '0' end as is_run
from (select contractno,contractid,the_date,project_guid,issk  from tempcotract where rn=1 )h
left join (select  contractno,contractid,the_date,project_guid  from tempcotract where  is_bill='1' and rn=1)a
on h.the_date=a.the_date and h.project_guid=a.project_guid and h.contractno=a.contractno
left join (select  contractno,contractid,the_date,project_guid from tempcotract where  is_jp='1'  and rn=1 )b
on  h.contractno=b.contractno and h.the_date=b.the_date and h.project_guid=b.project_guid
left join (select  contractno,contractid,the_date,project_guid from tempcotract where  is_open='1' and rn=1)c
on  h.contractno=c.contractno and h.the_date=c.the_date and h.project_guid=c.project_guid
left join (select  contractno,contractid,the_date,project_guid from tempcotract where  is_filling='1' and rn=1)d
on h.contractno=d.contractno  and h.the_date=d.the_date  and h.project_guid=d.project_guid
left join (select  contractno,contractid,the_date,project_guid  from tempcotract where rn=1 and is_filing_receipt='1')e
on h.contractno=e.contractno  and h.the_date=e.the_date  and h.project_guid=e.project_guid
left join (select  contractno,contractid,the_date,project_guid  from tempcotract where rn=1 and is_run='1')f
on h.contractno=f.contractno  and h.the_date=f.the_date  and h.project_guid=f.project_guid
),
temprentdata1 as
(select
c1.the_date
,c1.contractno
,c1.contractid
,c1.project_guid
,ysdata.bdamt_y
,ysdata.ccamt_y
,ysdata.wgamt_y
,ysdata.tgamt_y
,ysdata.syamt_y
,ysdata.bdamt_n
,ysdata.ccamt_n
,ysdata.wgamt_n
,ysdata.tgamt_n
,ysdata.syamt_n
,ysdata.lqbdamt_y
,ysdata.lqccamt_y
,ysdata.lqwgamt_y
,ysdata.lqtgamt_y
,ysdata.lqsyamt_y
,ysdata.lqbdamt_n
,ysdata.lqccamt_n
,ysdata.lqwgamt_n
,ysdata.lqtgamt_n
,ysdata.lqsyamt_n
,ysdata.startdate
,ysdata.enddate
from  tempcotract c1
left join (select a.the_date
,rc.contractno
,rc.projectguid
,sum(case
when bill.billitemname = '保底租金' and substr(bill.startdate,1,10) = substr(a.the_date,1,10) then
bill.documentamt
else
0
end) bdamt_y
,sum(case
when bill.billitemname = '抽成租金' and substr(bill.startdate,1,10) = substr(a.the_date,1,10) then
bill.documentamt
else
0
end) ccamt_y
,sum(case when bill.billitemname = '物业管理服务费' and substr(bill.startdate ,1,10) = substr(a.the_date,1,10) then
bill.documentamt
else
0
end) wgamt_y
,sum(case when bill.billitemname = '推广服务费' and substr(bill.startdate ,1 ,10) = substr(a.the_date,1 ,10) then
bill.documentamt
else
0
end) tgamt_y
,sum(case when bill.billitemname = '收银机租金' and substr(bill.startdate ,1,10) = substr(a.the_date ,1 ,10) then
bill.documentamt
else
0
end ) as syamt_y
,sum(case
when bill.billitemname = '保底租金' and substr(bill.startdate,1,10) = substr(a.the_date,1,10) then
bill.baseamt
else
0
end) bdamt_n
,sum(case
when bill.billitemname = '抽成租金' and substr(bill.startdate,1,10) = substr(a.the_date,1,10) then
bill.baseamt
else
0
end) ccamt_n
,sum(case when bill.billitemname = '物业管理服务费' and substr(bill.startdate ,1,10) = substr(a.the_date,1,10) then
bill.baseamt
else
0
end) wgamt_n
,sum(case when bill.billitemname = '推广服务费' and substr(bill.startdate ,1 ,10) = substr(a.the_date,1 ,10) then
bill.baseamt
else
0
end) tgamt_n
,sum(case when bill.billitemname = '收银机租金' and substr(bill.startdate ,1,10) = substr(a.the_date ,1 ,10) then
bill.baseamt
else
0
end ) as syamt_n
,sum(case
when bill.billitemname = '保底租金' then
bill.documentamt
else
0
end) lqbdamt_y
,sum(case
when bill.billitemname = '抽成租金' then
bill.documentamt
else
0
end) lqccamt_y
,sum(case when bill.billitemname = '物业管理服务费' then
bill.documentamt
else
0
end) lqwgamt_y
,sum(case when bill.billitemname = '推广服务费'  then
bill.documentamt
else
0
end) lqtgamt_y
,sum(case when bill.billitemname = '收银机租金' then
bill.documentamt
else
0
end ) as lqsyamt_y
,sum(case
when bill.billitemname = '保底租金'  then
bill.baseamt
else
0
end) lqbdamt_n
,sum(case
when bill.billitemname = '抽成租金'  then
bill.baseamt
else
0
end) lqccamt_n
,sum(case when bill.billitemname = '物业管理服务费'  then
bill.baseamt
else
0
end) lqwgamt_n
,sum(case when bill.billitemname = '推广服务费'  then
bill.baseamt
else
0
end) lqtgamt_n
,sum(case when bill.billitemname = '收银机租金'  then
bill.baseamt
else
0
end ) as lqsyamt_n
,min(bill.startdate)  as startdate
,max(bill.enddate)    as enddate
from date a
left join ${HIVE_DB_DWS}.f05_longfor_billschedule_detail bill
on 1 = 1
join ${HIVE_DB_DWS}.f05_longfor_contract rc
on bill.contractid = rc.contractid
where  rc.status not in ('INACTIVE'
,'ACTIVE'
,'SUBMITTED')
and bill.billitemname in ('保底租金'
,'抽成租金'
,'物业管理服务费'
,'推广服务费'
,'收银机租金')
group by rc.contractno
,a.the_date
,rc.projectguid)ysdata
on c1.contractno=ysdata.contractno
and c1.the_date=ysdata.the_date
and c1.project_guid=ysdata.projectguid
where  c1.rn=1  and is_close_date='1'
)
,tempxzc as
( --上期合同
select c1.projectid
,c1.contractno
,c.contractno as xzcontractno
from ${HIVE_DB_DWD_SYSMARTBI}.sysmartbi_rt_contract c
left join ${HIVE_DB_DWD_SYSMARTBI}.sysmartbi_rt_contract c1
on c.parentid = c1.contractid
where c.contracttype = 'RELET' --续签
and c.parentid is not null
and c.status not in ('SUBMITTED'
,'ACTIVE'
,'INACTIVE')),
tempb as
(select c.the_date
,c.contractid
,c1.contractid as lqcontractid
from tempcotract c
join ${HIVE_DB_DWD_SYSMARTBI}.sysmartbi_rt_contractunit cu
on c.contractid = cu.contractid
left join ${HIVE_DB_DWD_SYSMARTBI}.sysmartbi_rt_contractunit cu1
on cu.unitid = cu1.unitid
and cu1.status != '!ACTIVE'
left join tempcotract c1
on cu1.contractid = c1.contractid
and c.the_date=c1.the_date
where cu.status != '!ACTIVE'
group by c.contractid
,c1.contractid
,c.the_date),
templastc as
(select tc.the_date
,tc.contractid
,tc.lqcontractid
,tc.lqtotalrentarea     as lasttotalrentarea --上期合同面积
,tc.bsdate
,tc.bedate
,tc.lqbdamt_n--上期结束时间
,tc.lqccamt_n
,tc.lqwgamt_n
,tc.lqtgamt_n
,tc.lqsyamt_n
,tc.lqbdamt_y
,tc.lqccamt_y
,tc.lqwgamt_y
,tc.lqtgamt_y
,tc.lqsyamt_y
from (select row_number() over(partition by b.contractid, b.the_date order by c2.defaultstartdate desc) rn
,b.*
,c.contractno
,c.startdate as bsdate
,c.enddate   as bedate
,c3.totalarea as lqtotalrentarea
,c.lqbdamt_n     as lqbdamt_n
,c.lqccamt_n     as lqccamt_n
,c.lqwgamt_n     as lqwgamt_n
,c.lqtgamt_n     as lqtgamt_n
,c.lqsyamt_n     as lqsyamt_n
,c.lqbdamt_y
,c.lqccamt_y
,c.lqwgamt_y
,c.lqtgamt_y
,c.lqsyamt_y
from tempb b
left join temprentdata1 c
on b.lqcontractid = c.contractid
and b.the_date=c.the_date
left join ${HIVE_DB_DIM}.d05_longfor_contract c3
on c.contractid=c3.contract_id
left join temprentdata1 c1
on b.contractid = c1.contractid
and b.the_date = c1.the_date
left join ${HIVE_DB_DIM}.d05_longfor_contract c2
on c1.contractid=c2.contract_id
where substr(c2.defaultstartdate,1,10) > substr(c3.overlay_date,1,10)
) tc
where tc.rn=1)
insert overwrite table ${HIVE_DB_DWS}.f05_contract  partition (datekey)
SELECT a.year
,a.the_date
,b.companyguid as companyguid
,b.project_guid as projectguid
,nvl(b.contractid
,'-') as contractid
,lq.lqcontractid   --上期合同id
,b.contractno
,b.branddesc
,b.main_formatid  as mainformatid
,b.account_id  as accountid
,b.account_name  as accountname
,b.contract_type  as contracttype
,b.contracttypedesc  as contracttypedesc
,b.rental_type   as  rentaltype   --合同出租类型(专卖店、主力店等)
,nvl(b.topparent_id
,'-') as topparentid   --顶级父级合同id
,nvl(b.parentid
,'-') as parentid      --父级id
,b.sign_type
,b.is_start            --是否已开始
,b.is_end              --是否已结束
,b.issk               --是否已收款
,b.is_yrent           --是否已出租
,b.is_openrent        --是否已开业
,b.is_jprent          --是否已接铺
,b.is_confilling      --是否已归档
,b.is_confilling_receipt --是否已收款
,b.is_run            --是否已提网
,b.totalarea
,lq.lasttotalrentarea  as   lqtotalarea  --上期合同面积
,b1.bdamt_y           --保底租金
,b1.ccamt_y           --抽成租金
,b1.wgamt_y           --物管租金
,b1.tgamt_y           --推广租金
,b1.syamt_y           --收银机租金
,b1.bdamt_n           --保底租金
,b1.ccamt_n           --抽成租金
,b1.wgamt_n           --物管租金
,b1.tgamt_n           --推广租金
,b1.syamt_n           --收银机租金
,lq.lqbdamt_y        --上期保底租金
,lq.lqccamt_y        --上期抽成租金
,lq.lqwgamt_y        --上期物管
,lq.lqtgamt_y        --上期推广租金
,lq.lqsyamt_y          --上期收银机租金
,lq.lqbdamt_n        --上期保底租金
,lq.lqccamt_n        --上期抽成租金
,lq.lqwgamt_n        --上期物管
,lq.lqtgamt_n        --上期推广租金
,lq.lqsyamt_n          --上期收银机租金
,nvl(ys.bd_income_y
,'0') as bd_income_y  --保底租金收入含税
,nvl(ys.taking_income_y
,'0') as taking_income_y --抽成租金收入不含税
,nvl(ys.mng_income_y,'0') as mng_income_y  --物业租金收入
,nvl(ys.tg_income_y,'0')  as tg_income_y   --推广物业租金收入
,nvl(ys.bd_income_n,'0')  as bd_income_n   --保底租赁收入不含税
,nvl(ys.taking_income_n,'0')  as taking_income_n  --抽成租金收入不含税
,nvl(ys.mng_income_n,'0')   as mng_income_n       --物业服务费不含税
,nvl(ys.tg_income_n,'0')   as tg_income_n         --推广不含税
,nvl(sd1.ccblmode
,'0') as m_ccblmode --抽成模式
,nvl(sd1.revenueratemin
,'0') as revenueratemin --低扣率
,nvl(sd1.revenueratemax,'0')  as revenueratemax  --高扣率
,bg.bgrent_amt
,bg.bgmng_amt
,bg.bgpromotion_amt
,bg.bgfmr_amt
,bg.bgrevenue_amt
,bg.rentamt
,bg.takingamt
,bg.mngamt
,bg.promotionamt
,bg.fmramt
,bg.unit_fmr
,bg.inter_amount
,bg.middle_amount
,bg.inter_mngfee
,bg.inter_rentfee
,bg.inter_revenufee
,bg.inter_promotivefee
,bg.bg_jparea
,from_unixtime(unix_timestamp()
,'yyyy-MM-dd HH:mm:ss') as op_time
,'${EXECUTION_ID}' as execution_id
,'${CURRENT_FLOW_START_DAY}' as load_date
,substr(a.the_date,1,7)  as datekey
from date a
left join(select
a.the_date
,a.contractno
,a.contractid
,a.project_guid
,a.issk
,a.is_yrent  as is_yrent
,a.is_jp  as is_jprent
,b.totalarea
,a.is_open  as is_openrent
,a.is_filling as is_confilling
,a.is_filing_receipt as is_confilling_receipt
,a.is_run
,b.companyguid
,case when   b.filing_date<=a.the_date then '1'  else '0' end as is_start
,case when   b.close_date<=a.the_date  then '1' else '0' end as is_end
,case  when  substr(b.filing_date,1,7)=substr(a.the_date,1,7) and  b.contract_type='NEW' then '新签'
when substr(b.filing_date,1,7)=substr(a.the_date,1,7) and  b.contract_type='CHANGE' then '变更'
else '-' end  sign_type
,nvl(b.topparent_id
,'-') as topparent_id   --顶级父级合同id
,nvl(b.parentid
,'-') as parentid
,b.branddesc
,b.main_formatid
,b.account_id
,b.account_name
,b.contract_type
,b.contracttypedesc
,b.rental_type
from  contract_status a
left join ${HIVE_DB_DIM}.d05_longfor_contract b
on a.contractid=b.contract_id)  b
on a.the_date=b.the_date
left join  temprentdata1 b1
on a.the_date=b1.the_date
and b.contractno=b1.contractno
and b.project_guid=b1.project_guid
left join (select a.year
,a.the_date
,nvl(bill.projectguid
,'-') as projectguid
,nvl(bill.CONTRACTNO
,'-') as CONTRACTNO
,sum(case when bill.documentamt is not null and  bill.feename='保底租金' then bill.documentamt else 0 end) as bd_income_y          --含税保底收入
,SUM(case when bill.documentamt is not null and  bill.feename='抽成租金' then bill.documentamt else 0 end ) as taking_income_y      --含税抽成收入
,SUM(case when bill.documentamt is not null and  bill.feename='物业管理服务费' then bill.documentamt else 0 end) as mng_income_y   --含税物业收入
,SUM(case when bill.documentamt is not null and  bill.feename='推广服务费' then bill.documentamt else 0 end) as tg_income_y        --含税推广收入
,SUM(case when bill.baseamt is not null and  bill.feename='保底租金' then bill.baseamt else 0 end) as bd_income_n                  --不含税保底
,SUM(case when bill.baseamt is not null and  bill.feename='抽成租金' then bill.baseamt else 0 end) as taking_income_n              --不含税抽成
,SUM(case when bill.baseamt is not null and  bill.feename='物业管理服务费' then bill.baseamt else 0 end) as mng_income_n           --不含税物业
,SUM(case when bill.baseamt is not null and  bill.feename='推广服务费' then bill.baseamt else 0 end) as tg_income_n                --不含税推广
from date a
left join ${HIVE_DB_DWS}.f05_longfor_rent_income bill
on 1 = 1
where bill.feename in ('保底租金'
,'抽成租金'
,'物业管理服务费'
,'推广服务费')
--and bill.RENTALTYPE in ('Main'
--                       ,'Exclusive'
--                       ,'SubAnchor'
--                       ,'Site'
--                       ,'SingleCabinet')
and bill.isexport = 'Y' --已成功签订

and substr(income_date
,1
,10) = a.the_date
group by bill.projectguid
,a.year
,a.the_date
,bill.CONTRACTNO
) ys
on a.year = ys.year
and a.the_date = ys.the_date
and b.project_guid = ys.projectguid
and b.contractno = ys.contractno
left join (select a.year
,a.the_date
,c.project_guid
,c.contractno
,cpcc.titlecn as ccblmode -- 抽成比例模式
,ccdata.revenueratemin
,ccdata.revenueratemax
from date a
left join temprentdata1 c
on  a.the_date = c.the_date
left join ${HIVE_DB_DIM}.d05_longfor_contract c1
on c.contractid=c1.contract_id
left join ( --本月抽成比例
select charge.contractid
,max(detail.revenuemethod) revenuemethod --抽成模式
,min(detail.revenuerate) revenueratemin
,greatest(max(detail.revenuerate)
,max(detail.maxprecentage)) as  revenueratemax
from ${HIVE_DB_DIM}.d05_longfor_contractcharge charge
join (select detail.contractchargeid
,nvl(step.minprecentage
,detail.revenuerate) revenuerate
,nvl(step.maxprecentage
,0) maxprecentage
,detail.minamount
,detail.startdate
,detail.enddate
,detail.revenuemethod
from ${HIVE_DB_DWS}.f05_longfor_contractchargedetail detail
left join (select contractchargedetailid
,min(precentage) minprecentage
,max(precentage) maxprecentage
from ${HIVE_DB_DIM}.d05_longfor_contractchargestep
where status <> 'INACTIVE'
group by contractchargedetailid) step
on detail.contractchargedetailid =
  step.contractchargedetailid
where status <> 'INACTIVE') detail
on detail.contractchargeid =
  charge.contractchargeid
where charge.status = 'ACTIVE'
and charge.billitemid = 'RevenueFee'
group by charge.contractid) ccdata
on ccdata.contractid = c.contractid
left join ${HIVE_DB_DWD_SYSMARTBI}.sysmartbi_cf_popuplstelement cpcc
on cpcc.poptype = 'RT.RentCalcMode'
and cpcc.elementcode = c1.rentcal_mode
group by  a.year
,a.the_date
,c.project_guid
,c.contractno
,cpcc.titlecn  -- 抽成比例模式
,ccdata.revenueratemin
,ccdata.revenueratemax
) sd1
on a.the_date = sd1.the_date
and b.contractno = sd1.contractno
and b.project_guid = sd1.project_guid
left join templastc  lq
on a.the_date=lq.the_date
and b.contractid=lq.contractid
left join (select
the_date
,projectguid
,contractid
,sum(bgrent_amt) as    bgrent_amt
,sum(bgmng_amt)  as   bgmng_amt
,sum(bgpromotion_amt)   as   bgpromotion_amt
,sum(bgfmr_amt)       as   bgfmr_amt
,sum(bgrevenue_amt)   as    bgrevenue_amt
,sum(rentamt)         as    rentamt
,sum(takingamt)       as takingamt
,sum(mngamt)          as      mngamt
,sum(promotionamt)     as   promotionamt
,sum(fmramt)          as     fmramt
,sum(unit_fmr)        as      unit_fmr
,sum(inter_bgamount)    as    inter_amount
,sum(middle_bgamount)     as    middle_amount
,sum(inter_bgmngfee)      as     inter_mngfee
,sum(inter_bgrentfee)     as   inter_rentfee
,sum(inter_bgrevenufee)    as   inter_revenufee
,sum(inter_bgpromotivefee)   as inter_promotivefee
,sum(bg_jparea)            as bg_jparea
from  ${HIVE_DB_DWS}.f05_unit
group by the_date
,projectguid
,contractid
)bg
on a.the_date=bg.the_date
and b.contractid=bg.contractid
union all
  select
 year
,the_date
,companyguid
,projectguid
,contractid
,lqcontractid
,contractno
,branddesc
,mainformatid
,accountid
,accountname
,contracttype
,contracttypedesc
,rentaltype
,topparentid
,parentid
,sign_type
,is_start
,is_end
,issk
,is_yrent
,is_openrent
,is_jprent
,is_confilling
,is_confilling_receipt
,is_run
,totalarea
,lqtotalarea
,bdamt_y
,ccamt_y
,wgamt_y
,tgamt_y
,syamt_y
,bdamt_n
,ccamt_n
,wgamt_n
,tgamt_n
,syamt_n
,lqbdamt_y
,lqccamt_y
,lqwgamt_y
,lqtgamt_y
,lqsyamt_y
,lqbdamt_n
,lqccamt_n
,lqwgamt_n
,lqtgamt_n
,lqsyamt_n
,bd_income_y
,taking_income_y
,mng_income_y
,tg_income_y
,bd_income_n
,taking_income_n
,mng_income_n
,tg_income_n
,m_ccblmode
,revenueratemin
,revenueratemax
,bgrent_amt
,bgmng_amt
,bgpromotion_amt
,bgfmr_amt
,bgrevenue_amt
,rentamt
,takingamt
,mngamt
,promotionamt
,fmramt
,unit_fmr
,inter_amount
,middle_amount
,inter_mngfee
,inter_rentfee
,inter_revenufee
,inter_promotivefee
,bg_jparea
,op_time
,execution_id
,load_date
,datekey
    from ${HIVE_DB_DWS}.f05_contract
      WHERE the_date>=concat(substr(date_sub('${START_DATEKEY}',30),1,7),'-01')
and the_date<date_sub('${START_DATEKEY}',2)  and  cast(substr('${END_DATEKEY}',9,2)  as int)<>3
;
"
task_incre_type=multi-day
