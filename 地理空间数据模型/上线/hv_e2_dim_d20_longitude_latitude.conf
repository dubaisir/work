sql="
use ${HIVE_DB_DIM};
set hive.exec.dynamic.partition.mode=nonstric ;
--oms小区经纬度坐标
with d09_longfor_gydtsy_oms_project as (
select
'd09_longfor_gydtsy_oms_project' as sourcetable                  -- '来源表'
,'oms项目维度表'                   as sourcetabledsr               -- '来源表描述'
,'C3'                              as channel                      -- '航道代码'
,'高德'                             as location_type                -- '坐标类型'
,longitude                          as lng                          -- '查询经度'
,latitude                           as lat                          -- '查询纬度'
from ${HIVE_DB_DIM}.d09_longfor_gydtsy_oms_project
)
--玺泰租房供应小区经纬度坐标
,d20_village as (
select
'd20_village'                         as sourcetable                  -- '来源表'
,'玺泰租房供应小区维度表'            as sourcetabledsr               -- '来源表描述'
,'C3'                              as channel                      -- '航道代码'
,'高德'                             as location_type                -- '坐标类型'
,split(location,',')[0]             as  lng                          -- '查询经度'
,split(location,',')[1]             lat                          -- '查询纬度'
from ${HIVE_DB_DIM}.d20_village

)
--链家租房成交小区经纬度坐标
,d20_link_viliage_basic as (
select
'd20_link_viliage_basic'           as sourcetable                  -- '来源表'
,'链家租房成交小区维度表'            as sourcetabledsr               -- '来源表描述'
,'C3'                               as channel                      -- '航道代码'
,'高德'                             as location_type                -- '坐标类型'
,longitude                          as lng                          -- '查询经度'
,latitude                           as lat                          -- '查询纬度'
from ${HIVE_DB_DIM}.d20_link_viliage_basic
)
--租房竞品交易经纬度坐标
,f20_spider_house_all as (
select
'f20_spider_house_all'           as sourcetable                  -- '来源表'
,'租房竞品交易表'            as sourcetabledsr               -- '来源表描述'
,'C3'                               as channel                      -- '航道代码'
,'高德'                             as location_type                -- '坐标类型'
,lon                               as lng                          -- '查询经度'
,lat                               as lat                          -- '查询纬度'
from ${HIVE_DB_DWS}.f20_spider_house_all
)
,inc_table as (
select
 a.sourcetable                  -- '来源表'
,a.sourcetabledsr               -- '来源表描述'
,a.channel                      -- '航道代码'
,a.location_type                -- '坐标类型's
,round(cast(a.lng as double),7 )  as lng                          -- '查询经度'
,round(cast(a.lat as double),7 )  as lat                          -- '查询纬度'
from(
           select * from d09_longfor_gydtsy_oms_project
union all select * from d20_village
union all select * from d20_link_viliage_basic
union all select * from f20_spider_house_all
)a
group by
 a.sourcetable                  -- '来源表'
,a.sourcetabledsr               -- '来源表描述'
,a.channel                      -- '航道代码'
,a.location_type                -- '坐标类型'
,round(cast(a.lng as double),7 )                          -- '查询经度'
,round(cast(a.lat as double),7 )                          -- '查询纬度'
)

insert overwrite table d20_longitude_latitude partition (load_date)
select
 a.sourcetable                  -- '来源表'
,a.sourcetabledsr               -- '来源表描述'
,a.channel                      -- '航道代码'
,a.location_type                -- '坐标类型'
,a.lng                          -- '查询经度'
,a.lat                          -- '查询纬度'
,'' as year                     -- '查询年'
,false as haspolyline              -- '是否包含边界'
,from_unixtime( unix_timestamp(), 'yyyy-MM-dd HH:mm:ss')     as op_time
,'${EXECUTION_ID}'                                          as execution_id
,'${CURRENT_FLOW_START_DAY}'                                as load_date

from
inc_table a
left join  dim.d20_longitude_latitude b
on  a.sourcetable        = b.sourcetable                  -- '来源表'
and a.sourcetabledsr     = b.sourcetabledsr               -- '来源表描述'
and a.channel            = b.channel                      -- '航道代码'
and a.location_type      = b.location_type                -- '坐标类型'
and a.lng                = b.lng                          -- '查询经度'
and a.lat                = b.lat                          -- '查询纬度'
where b.sourcetable     is null             -- '来源表'
and   b.sourcetabledsr  is null             -- '来源表描述'
and   b.channel         is null             -- '航道代码'
and   b.location_type   is null             -- '坐标类型'
and   b.lng             is null             -- '查询经度'
and   b.lat             is null             -- '查询纬度'

;
"

task_incre_type=multi-day